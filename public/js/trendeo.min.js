/*! Trendeo 2016-04-03 */
function FacebookHandler(){function a(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}function b(){window.fbAsyncInit=function(){FB.init({appId:"1641122906121098",cookie:!0,xfbml:!0,version:"v2.2"}),FB.getLoginStatus(function(a){"connected"===a.status&&($("#fbloginbutton").remove(),fbhandler.getProfileInfo())})}}new User("","");this.setUp=function(){a(),b()}}function setUp(){var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}function onYouTubeIframeAPIReady(){setUpAll()}function setUpAll(){var a=new UIController,b=new VideoManager,c=new YTHandler,d=new PlayerManager(c,b,a),e=new FacebookHandler(d),f=new UserControl(d,a,b);a.setUp(),f.setUp(),e.setUp(),d.setUp()}function PlayerManager(a,b,c){function d(){o();var c=b.getCurrChannel(),d=b.loadVideos(c);d?d.always(function(){n(),g(),a.initSetUp()}):(n(),g(),a.initSetUp())}function e(a){var c=b.loadVideos(a);c?c.always(function(){b.setCurrChannel(a),j(b.getCurrVideo()[0],b.getPrevVideo()[0],b.getNextVideo()[0])}):(b.setCurrChannel(a),j(b.getCurrVideo()[0],b.getPrevVideo()[0],b.getNextVideo()[0]))}function f(){var a="searched",c=search.getSearchedVideos();c.length>0&&(b.setCurrChannel(a),b.putList(a,c),j(b.getCurrVideo()[0],b.getPrevVideo()[0],b.getNextVideo()[0]))}function g(){u=a.newYTPlayer("curr",b.getCurrVideo()[0],r,i,s),v=a.newYTPlayer("prev",b.getPrevVideo()[0],r,i,s),w=a.newYTPlayer("next",b.getNextVideo()[0],r,i,s),setInterval(function(){try{$("#timebar").width(a.getVideoProgress(u)+"%")}catch(b){}},50)}function h(){var a=search.loadVideos(search.search_str);a?a.always(function(){f()}):f()}function i(c){c.target==u&&(b.removeCurrVideo(),a.loadYTVideo(u,b.getCurrVideo()[0]),a.loadYTVideo(w,b.getNextVideo()[0])),c.target==w&&(b.removeNextVideo(),a.loadYTVideo(w,b.getNextVideo()[0]))}function j(b,c,d){a.loadYTVideo(u,b),a.loadYTVideo(v,c),a.loadYTVideo(w,d)}function k(){return b.getCurrIndex()==b.getListLength()-1?(b.next(),a.loadYTVideo(u,b.getCurrVideo()[0]),void a.loadYTVideo(w,b.getNextVideo()[0])):(a.pauseYTVideo(u),x=v,v=u,u=w,w=x,a.playYTVideo(u),b.next(),b.getCurrIndex()<b.getListLength()-1&&a.loadYTVideo(w,b.getNextVideo()[0]),a.seekYT(v,0),a.seekYT(w,0),x=A,A=y,y=z,z=x,$(y).css("display","block"),$(z).css("display","none"),$(A).css("display","none"),c.loadTitle(b.getCurrVideo()[1]),c.animateTimeBar(),c.setThumbnailImageR(b.getNextVideo()[0]),void c.setThumbnailImageL(b.getPrevVideo()[0]))}function l(){return 0==b.getCurrIndex()?void seekYT(u,0):(a.pauseYTVideo(u),x=w,w=u,u=v,v=x,a.playYTVideo(u),b.prev(),b.getCurrIndex()>0&&a.loadYTVideo(v,b.getPrevVideo()[0]),a.seekYT(v,0),a.seekYT(w,0),x=z,z=y,y=A,A=x,$(y).css("display","block"),$(z).css("display","none"),$(A).css("display","none"),c.loadTitle(b.getCurrVideo()[1]),c.animateTimeBar(),c.setThumbnailImageR(b.getNextVideo()[0]),void c.setThumbnailImageL(b.getPrevVideo()[0]))}function m(a){window.history.replaceState("object","Trendeo: Trending Videos of Now","/ch/"+b.getCurrChannel()+"/"+a)}function n(){"#_=_"==window.location.hash&&(window.location.hash="",history.replaceState("",document.title,window.location.pathname));var a=q()[1];return b.setCurrVideo(a)}function o(){var a=q()[0];"liked"==a?b.setCurrChannel("all"):"searched"==a?b.setCurrChannel("all"):a.length>0?b.setCurrChannel(a):b.setCurrChannel("all")}function p(d){var e=a.getYTDuration(u),f=a.getYTCurrentTime(u);return-1==d&&(d=(10*f/e-1)*e/10),-2==d&&(d=(10*f/e+1)*e/10),-3==d&&(d=a.getYTCurrentTime(u)-3.5),-4==d&&(d=a.getYTCurrentTime(u)+3),0>d?(0==b.getCurrIndex()&&a.seekYT(u,0),l(),void c.animateTitle()):d>=e?(k(),void c.animateTitle()):void a.seekYT(u,d)}function q(){var a=window.location.href;if(a.indexOf("/ch/")>0){var b=a.substring(a.indexOf("/ch/")+4),c=b.substring(0,b.indexOf("/")),d=b.substring(b.indexOf("/")+1);return 0==c.length&&(c=b,d=""),[c,d]}return["",""]}function r(b){u==b.target&&(currready=!0,B&&setTimeout(function(){$(y).css("display","block"),a.seekYT(u,0),B=!1},1e3)),v==b.target&&(prevready=!0),w==b.target&&(nextready=!0)}function s(d){d.data==YT.PlayerState.UNSTARTED&&(a.playYTVideo(d.target),d.target==u&&$("#bowlG").remove()),d.data==YT.PlayerState.PLAYING&&(m(b.getCurrVideo()[0]),a.pauseYTVideo(v),a.pauseYTVideo(w),document.activeElement.blur(),c.loadTitle(b.getCurrVideo()[1]),c.animateTitle(),c.setChannelName(b.getCurrChannel()),c.animateChannels()),d.data==YT.PlayerState.ENDED&&(k(),c.animateTitle())}function t(){2==a.getYTPlayerState(u)?a.playYTVideo(u):a.pauseYTVideo(u)}var u=null,v=null,w=null,x=null,y="#curr",z="#next",A="#prev",B=!0;this.setUp=function(){d()},this.setNewChannel=function(a){e(a)},this.loadSearchedVideos=function(){h()},this.nextVideo=function(){k()},this.previousVideo=function(){l()},this.skipVideoTo=function(a){p(a)},this.getYTCurrentTime=function(b){return a.getYTCurrentTime(b)},this.pauseVideo=function(){a.pauseYTVideo(u)},this.getCurrentTime=function(){return a.getYTCurrentTime(u)},this.togglePlayPause=function(){t()}}function Search(){this.search_str="",this.searchedVideos=[],this.searched=null}function UIController(){function a(){window.onmousemove=function(a){l()}}function b(){h("#fbdiv",1),clearTimeout(v),v=setTimeout(function(){i("#fbdiv")},2e3)}function c(){h(".top-icon",1),clearTimeout(v),v=setTimeout(function(){i(".top-icon")},2e3)}function d(){h("#title",1),clearTimeout(r),r=setTimeout(function(){i("#title")},2e3)}function e(){h("#arrowL",.75),h("#arrowR",.75),clearTimeout(q),q=setTimeout(function(){i("#arrowL"),i("#arrowR")},2e3)}function f(){h("#timebar",.75),clearTimeout(s),s=setTimeout(function(){i("#timebar")},2e3)}function g(){h("#channels",.75),clearTimeout(u),u=setTimeout(function(){i("#channels")},2e3)}function h(a,b){$(a).animate({opacity:b},{queue:!1,duration:o})}function i(a){$(a).animate({opacity:0},{queue:!1,duration:p})}function j(a){$("#title").text(a.replace("&amp;","&"))}function k(a){$("#currchannel").text(a)}function l(){x?(clearTimeout(q),clearTimeout(r),clearTimeout(s),clearTimeout(t),clearTimeout(u),clearTimeout(v),clearTimeout(w),q=setTimeout(function(){i("#arrowL"),i("#arrowR")},2e3),r=setTimeout(function(){i("#title")},2e3),s=setTimeout(function(){i("#timebar")},2e3),u=setTimeout(function(){i("#channels")},2e3),v=setTimeout(function(){i(".top-icon")},2e3),w=setTimeout(function(){i("#fbdiv")},2e3),t=setTimeout(function(){document.body.style.cursor="none"},2500)):(x=!0,d(),e(),f(),g(),c(),b(),setTimeout(function(){x=!1},o),document.body.style.cursor="default")}function m(a){$("#arrowL").attr("src")!="http://img.youtube.com/vi/"+a+"/0.jpg"&&$("#arrowL").attr("src","http://img.youtube.com/vi/"+a+"/0.jpg")}function n(a){$("#arrowR").attr("src")!="http://img.youtube.com/vi/"+a+"/0.jpg"&&$("#arrowR").attr("src","http://img.youtube.com/vi/"+a+"/0.jpg")}var o=500,p=1e3,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=!1;this.setUp=function(){a()},this.animateTitle=function(){d()},this.animateTimeBar=function(){f()},this.animateChannels=function(){g()},this.loadTitle=function(a){j(a)},this.setChannelName=function(a){k(a)},this.animateAll=function(){l()},this.setThumbnailImageL=function(a){m(a)},this.setThumbnailImageR=function(a){n(a)}}function User(a,b){var a=a,b=b,c=[],d=!1,e=this;this.getUserId=function(){return a},this.setUserId=function(a){this.userId=a},this.getAccessToken=function(){return b},this.setAccessToken=function(a){this.accessToken=a},this.loadVideos=function(){if(void 0!=b&&!d){var a="/api/user/"+b;return $.getJSON(a,function(a){e.setLikedVideos(a),e.updated=!0})}},this.getLikedVideos=function(){return c},this.setLikedVideos=function(a){c=a},this.likeVideo=function(a){var b="/api/user/"+this.accessToken,c={updown:"up",video:a},d=this;return $.post(b,c,function(a){console.log(a),d.updated=!1},"json")}}function UserControl(a,b,c){function d(){$(window).blur(function(){l=!1}),$(document.activeElement).keydown(function(c){if(13==c.which&&0==search.search_str.length&&k(),32==c.which&&(0==search.search_str.length&&a.togglePlayPause(),b.animateAll()),37==c.which){if(1==++o)return;b.animateTimeBar(),a.skipVideoTo(-3)}if(39==c.which){if(1==++o)return;b.animateTimeBar(),a.skipVideoTo(-4)}38==c.which&&(b.animateTimeBar(),a.skipVideoTo(-2)),40==c.which&&(b.animateTimeBar(),a.skipVideoTo(-1))}),$(document.activeElement).keyup(function(c){37==c.which&&(2>o&&(a.previousVideo(),b.animateTitle()),o=0),39==c.which&&(2>o&&(a.nextVideo(),b.animateTitle()),o=0)}),$("#glass").click(function(a){e()}),$("#title").click(function(a){j()}),$("#arrowL").mousedown(function(a){f(),u=setInterval(f,200)}).bind("mouseup mouseleave",function(){clearInterval(u)}),$("#arrowR").mousedown(function(a){g(),t=setInterval(g,200)}).bind("mouseup mouseleave",function(){clearInterval(t)}),$("#arrowL").mouseup(function(a){h()}),$("#arrowR").mouseup(function(a){i()}),$("#arrowL").click(function(a){a.stopPropagation()}),$("#arrowR").click(function(a){a.stopPropagation()}),$("#arrowL").mousemove(function(a){b.setThumbnailImageL(c.getPrevVideo()[0]),w=!0}),$("#arrowR").mousemove(function(a){b.setThumbnailImageR(c.getNextVideo()[0]),x=!0}),$("#arrowL").mouseleave(function(a){$("#arrowL").attr("src","/res/arrowLeft.png"),$("#arrowR").attr("src","/res/arrowRight.png"),w=!1}),$("#arrowR").mouseleave(function(a){$("#arrowL").attr("src","/res/arrowLeft.png"),$("#arrowR").attr("src","/res/arrowRight.png"),x=!1}),$("#home-icon").click(function(){a.setNewChannel("all")}),$("#heart-icon").click(function(){a.loadLikedVideos()}),$("#info-icon").click(function(){m?($("#glass").animate({backgroundColor:"rgba(0,0,0,0)"},"fast"),$("#about").fadeOut("fast"),$("#about").css("display","none"),m=!1):($("#glass").animate({backgroundColor:"rgba(0,0,0,0.75)"},"fast"),$("#about").fadeIn("fast"),$("#about").css("display","block"),m=!0)}),$("#about-modal-close").click(function(){$("#glass").animate({backgroundColor:"rgba(0,0,0,0)"},"fast"),$("#about").fadeOut("fast"),$("#about").css("display","none"),m=!1}),$("body").on("mousewheel",function(a){v+=a.originalEvent.wheelDelta,-s>v?(r=!1,setTimeout(function(){r=!0,v=0},1e3)):v>s&&(r=!1,setTimeout(function(){r=!0,v=0},1e3))}),$("#channel-icon").click(function(){$("body").toggleClass("channel-menu-push-toright"),$("#channel-menu").toggleClass("channel-menu-open")}),$(".channel").click(function(){a.setNewChannel($(this).attr("channel"))})}function e(){if(iOS)return alert("IOS"),void window.open("https://www.youtube.com/watch?v="+c.getCurrVideo()[0]+"&t="+Math.floor(a.getYTCurrentTime(curr))+"s");if(!y){var b=(new Date).getTime();n+q>b&&k(),n=b,a.togglePlayPause()}}function f(){1!=++p&&(b.animateAll(),a.skipVideoTo(-3))}function g(){1!=++p&&(b.animateAll(),a.skipVideoTo(-4))}function h(){y||(2>p&&(a.previousVideo(),b.animateTitle()),p=0)}function i(){y||(2>p&&(a.nextVideo(),b.animateTitle()),p=0)}function j(){a.pauseVideo(),window.open("https://www.youtube.com/watch?v="+c.getCurrVideo()[0]+"&t="+Math.floor(a.getCurrentTime())+"s")}function k(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}var l=!1,m=!1,n=0,o=0,p=0,q=300,r=!0,s=250,t=0,u=0,v=0,w=!1,x=!1,y="ontouchstart"in document.documentElement;iOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),this.setUp=function(){d()}}function VideoManager(){function a(a){if(void 0==w(a)){var b="/api/ch/"+a;return $.getJSON(b,function(b){d(b,a)})}}function b(a,b){var c="/api/vid/"+b;return $.getJSON(c,function(c){if(c.length>1){var d=c[1],e=0;u(a,e,[b,d]),o(a,e)}})}function c(){a(m()),a(n())}function d(a,b){var c=[];$.each(a,function(a,b){if(void 0!=b){var d=b[0],e=b[1],f=b[2];c.push([d,e,f])}}),void 0==w(b)&&v(b,c)}function e(){try{if(void 0==user)return;user.likeVideo(f())}catch(a){console.log(a.stack)}}function f(){var a=A[C];return z[C][a]}function g(){var a=A[C];return z[C][a<z[C].length-1?a+1:0]}function h(){var a=A[C];return z[C][a>0?a-1:a]}function i(){return A[C]}function j(){return void 0==z[C]?0:z[C].length}function k(){return C}function l(a){C=a,A[C]=0,D=p(C),c()}function m(){var a=D<B.length-1?D+1:0;return B[a]}function n(){var a=D>0?D-1:B.length-1;return B[a]}function o(a,b){A[a]=b}function p(a){return B.indexOf(a)<0&&(B.push(a),D=findChannelIndex(a)),D}function q(a){var c=t(a,j());return 0>c?b(C,a):void(A[C]=c)}function r(){z[C].splice(A[C],1)}function s(){z[C].splice(A[C]+1,1)}function t(a,b){for(var c=0;c<z[C].length&&b>c;c++)if(z[C][c][0]==a)return c;return-1}function u(a,b,c){z[a].unshift(c)}function v(a,b){z[a]=b}function w(a){return z[a]}function x(){A[C]=A[C]+1,A[C]>=z[C].length&&(A[C]=0)}function y(){A[C]=A[C]-1}var z={},A={},B=["all","gopro","youtubehaiku","bloopers","funnyvideos","fail","UnexpectedThugLife","StandUpComedy","deepintoyoutube","ContagiousLaughter","LearnUselessTalents","trailers","musicvideos","Music","sports","nba","soccer","nfl","PublicFreakout","StreetFights","respectporn","kidsafevideos"],C="all",D=0;this.loadVideos=function(b){return a(b)},this.procVideos=function(a,b){d(a,b)},this.likeCurrVideo=function(){e()},this.getCurrVideo=function(){return f()},this.getNextVideo=function(){return g()},this.getPrevVideo=function(){return h()},this.getCurrIndex=function(){return i()},this.getListLength=function(){return j()},this.getCurrChannel=function(){return k()},this.setCurrChannel=function(a){l(a)},this.setCurrVideo=function(a){q(a)},this.removeCurrVideo=function(){r()},this.removeNextVideo=function(){s()},this.next=function(){x()},this.prev=function(){y()}}function YTHandler(){function a(){player.stopVideo()}function b(a){var b=c(a),e=d(a);return b>0?100*e/b:0}function c(a){return a.getDuration()}function d(a){return a.getCurrentTime()}function e(a){a.pauseVideo()}function f(a){a.playVideo()}function g(a){return a.getPlayerState()}function h(a,b){a.loadVideoById({videoId:b,startSeconds:0,suggestedQuality:"large"})}function i(a,b){a.seekTo(b)}function j(a,b,c,d,e){return new YT.Player(a,{height:"390",width:"640",videoId:b,playerVars:{autoplay:0,showinfo:0,controls:0,iv_load_policy:3,disablekb:1},events:{onReady:c,onError:d,onStateChange:e}})}this.initSetUp=function(){(new Date).getTime()/1e3},this.stopVideo=function(){a()},this.getVideoProgress=function(a){return b(a)},this.getYTDuration=function(a){return c(a)},this.getYTCurrentTime=function(a){return d(a)},this.pauseYTVideo=function(a){e(a)},this.playYTVideo=function(a){f(a)},this.getYTPlayerState=function(a){return g(a)},this.loadYTVideo=function(a,b){h(a,b)},this.seekYT=function(a,b){i(a,b)},this.newYTPlayer=function(a,b,c,d,e){return j(a,b,c,d,e)}}setUp(),Search.prototype={loadVideos:function(a){var b=a.split(" "),c="http://www.reddit.com/r/videos/search.json?q=";for(s in b)c+=s+",";return c+="&sort=top&restrict_sr=on",$.getJSON(c,function(b){search.searchedVideos=[];for(child in b.data.children){var c=child.data.title,d=search.getURLFromItem(child);search.searchedVideos.push([d,c])}search.searched=a,search.search_str=""})},getSearchedVideos:function(){return this.searchedVideos},getURLFromItem:function(a){var b="";if("youtube.com"==a.data.domain||"youtu.be"==a.data.domain){null!=a.data.secure_media&&void 0!=a.data.secure_media?b=a.data.secure_media.oembed.url:null!=a.data.media&&void 0!=a.data.secure_media?b=a.data.media.oembed.url:null!=a.data.url&&void 0!=a.data.url&&(b=a.data.url),console.log(a.data);var c="",d=0;d="youtube.com"==a.data.domain?b.indexOf("v=")+2:b.indexOf("youtu.be/")+9;for(var e=b.charAt(d);/[a-zA-Z0-9-_ ]/.test(e);)c+=e,e=b.charAt(++d);return c}return""}};