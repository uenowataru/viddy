var moved = false;
var arrowtimeout;
var titletimeout;
var timebartimeout;
var cursortimeout;
var timebarprog = 1;
$(document).ready(function(){
  window.onmousemove = function(e){
    animateAll();
  };
});

$(document.activeElement).keydown(function(e) {
  if(!initialized) return;
  e.preventDefault(); // prevent the default action (scroll / move caret)
  if(e.which== 37){
    previousVideo();
    animateTitle();
  } //left
  if(e.which == 32){
    togglePlayPause();
    animateAll();
  } //space bar
  if(e.which== 39){
    nextVideo();
    animateTitle();
  } // right
  if(e.which== 38){
    animateTimeBar();
    skipVideoTo(-2);
  } //up  //fastforward
  if(e.which== 40){
    animateTimeBar();
    skipVideoTo(-1);
  } //down   //downward
  if(e.which >= 48 && e.which <= 57){
    animateTimeBar();
    skipVideoTo(e.which - 48);
  }
});

  

function animateAll(){
  if(!moved){
    moved = true;
    loadTitle();
    animateTitle();
    animateArrow();
    animateTimeBar();
    document.body.style.cursor = 'default';
  }else{
    clearTimeout(arrowtimeout);
    clearTimeout(titletimeout);
    clearTimeout(timebartimeout);
    clearTimeout(cursortimeout);
    arrowtimeout = setTimeout(function(){
      $( "#arrowL" ).animate({
        opacity: 0
      },1000);
      $( "#arrowR" ).animate({
        opacity: 0
      },1000);
      moved = false;
    }, 2000);
    titletimeout = setTimeout(function(){
      $( "#title" ).animate({
        opacity: 0
      },1000);
    }, 2000);
    timebartimeout = setTimeout(function(){
      $( "#timebar" ).animate({
        opacity: 0,
        color: "#000"
      }, 1000
      );
    }, 2000);
    cursortimeout = setTimeout(function(){
      document.body.style.cursor = 'none';
    }, 2500);
  }
}



function mouseClick(){
  togglePlayPause();
}

function arrowLeftClick(){
  previousVideo();
  animateTitle();
}
function arrowRightClick(){
  nextVideo();
  animateTitle();
}

function titleClick(){
  if(!initialized) return;
  pauseVideo();
  window.open("https://www.youtube.com/watch?v=" + queue[currindex][0]);
}

function loadTitle(){
  if(!initialized) return;
  var vidtitle = queue[currindex][1];
  $( "#title" ).text(vidtitle);
}

function animateTitle(){
  clearTimeout(titletimeout);
  $( "#title" ).animate({
    opacity: 0.75,
  },500);
  clearTimeout(titletimeout);
  titletimeout = setTimeout(function(){
    $( "#title" ).animate({
      opacity: 0
    },1000);
  }, 2000);

}

function animateArrow(){
  $( "#arrowL" ).animate({
    opacity: 0.5
  },500);
  $( "#arrowR" ).animate({
    opacity: 0.5
  },500);
  clearTimeout(arrowtimeout);
  arrowtimeout = setTimeout(function(){
    $( "#arrowL" ).animate({
      opacity: 0
    },1000);
    $( "#arrowR" ).animate({
      opacity: 0
    },1000);
  }, 2000);
}


function animateTimeBar(){
  $( "#timebar" ).animate({
    opacity: 0.75,
  },500);
  clearTimeout(timebartimeout);
  timebartimeout = setTimeout(function(){
    $( "#timebar" ).animate({
      opacity: 0,
    },1000);
  }, 2000);
}

setInterval(function(){
  try{
    $( "#timebar").width(getVideoProgress() + '%');
  }catch(err){
    //
  }
},50);


var canScroll = true;
var scrollThreshold = 25;
$('body').on ('mousewheel', function (e) {
  if(!initialized || !canScroll) return;
  var delta = e.originalEvent.wheelDelta;
  if (delta < -scrollThreshold) {
    canScroll = false;
    previousVideo();
    animateTitle();
    setTimeout(function() {
      canScroll = true;
    }, 500);
  } else if (delta > scrollThreshold) {
    canScroll = false;
    nextVideo();
    animateTitle();
    setTimeout(function() {
      canScroll = true;
    }, 500);
  }
});

function requestFullScreen(element) {
    // Supports most browsers and their versions.
    var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullscreen;
    if (requestMethod) { // Native full screen.
        requestMethod.call(element);
    } else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
        var wscript = new ActiveXObject("WScript.Shell");
        if (wscript !== null) {
            wscript.SendKeys("{F11}");
        }
    }
}






