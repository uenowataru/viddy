module.exports = {
	getUserJSON: function(userId, resfn){
		getUser(userId, resfn);
	},

	updateUserLikedVideos: function(userId, updown, video){
		updateUserLikes(userId, updown, video);
	}
};

var mongodb = require("./MongoDB.js");

function getUser(userId, resfn){
	mongodb.getUserFromDB(userId, function(user){
		mongodb.getVideosFromDB(user.vidLiked, function(videos){
			resfn(keyValueToArray(videos));
		})
	});
}

function keyValueToArray(videos){
	var temp = [];
	for(var i = 0; i < videos.length; i++){
		temp.push([videos[i].videoId, videos[i].videoTitle]);
	}
	return temp;
}

function updateUserLikes(userId, updown, video){
	if(updown=='up'){
		addUserLikedVideos(userId, video);
	}else{
		removeUserLikedVideos(userId, video);
	}
}

function addUserLikedVideos(userId, video){
	//console.log(userId + 'adding ' + video);
	mongodb.insertVideosToDB(arrayToKeyValue(video));
	mongodb.addUserLikesToDB(userId,video[0]);
}

function removeUserLikedVideos(userId, video){
	mongodb.removeUserLikedVideos(userId,video);
}

function arrayToKeyValue(video){
	return {'_id':video[0], 'videoId':video[0], 'videoTitle':video[1],'videoSubreddit':'all'};
}




